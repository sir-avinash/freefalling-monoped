
clc
clear all

%%%%% Initial Conditions %%%%%
g  = 9.81;
alpha0 = 90*pi/180; %rad  % landing angle 
x0=2;
dy0 = 0; %m/s
dx0 = 0;

%%%%% Leg Parameters (Shin Part) %%%%%
m = 8;
Lleg = 0.7;  %% changed from 1

%%%%% Spring props %%%%%
Y = 80*10^9; %% young's modulus
w = 0.03;    %% width of the leaf spring
h = 0.013;   %% thickness of the leaf spring
kbar = 2*Y*w*h^3;
L = 0.6;     %% free length of the spring 

%%%%% Solving Cubic Eqn for Equilibrium Position %%%%%
syms x
sols = double(simplify(solve(kbar*x/(L-x)^3 - m*g)));
xe = sols(1);





for i=1:4

%%% Free Fall Params %%%
y0 = (2.5*i)*Lleg; % free fall height

%%% Energy at Impact %%%
v1 = sqrt(2*g*(y0-Lleg));



E = m*g*Lleg + 0.5*m*v1^2; 

 
% eta = 1; %(v1/4.42)*1.0;  %% critical damping
% c = 2*eta*sqrt(m*k); % 
c = 170.5;

sim('landing_control_leafspring')
GRF{i}=grf.Data;
Tg{i}=grf.time;
X{i}=x;
DX{i}=dx.Data;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
T{i} =dx.time;
end

%  set(0,'DefaultLineLineWidth',1.5,'DefaultAxesColorOrder',[0 0 1],...
%    'DefaultAxesLineStyleOrder','-|--|:|-.', 'DefaultLineMarkerSize',1)

figure(2)

subplot(1,3,1)
line1 = plot(Tg{1},GRF{1,1},'b-',Tg{2},GRF{1,2},'b--',Tg{3},GRF{1,3},'b:',Tg{4},GRF{1,4},'b-.');
% xlabel('Time (s)')
ylabel('Ground Reaction Force (N)')
axis('tight')

subplot(1,3,2)
line2=plot(T{1},X{1},T{2},X{2},T{3},X{3},T{4},X{4});
% xlabel('Time (s)')
ylabel('Displacement (m)')
axis('tight')
% legend('h=2m','h=4m','h=6m','h=8m')
xlabel('Time (s)')
% figure(4)
subplot(1,3,3)
line3=plot(T{1},DX{1},T{2},DX{2},T{3},DX{3},T{4},DX{4});
% xlabel('Time (s)')
ylabel('Velocity (m/s)')
axis('tight')
% legend('h=2m','h=4m','h=6m','h=8m')

hL = legend('h=2m','h=4m','h=6m','h=8m');

max_stroke = [Lleg-min(X{1}),Lleg-min(X{2}),Lleg-min(X{3}),Lleg-min(X{4})];
% save('dyn_kc.mat','X','DX','GRF','T','Tg','max_stroke')





%%%% to do %%%%
%% add non-linear spring model
%% add max damper stroke
%% add max damper force limit
%% add damper model to spring disp calculation
%% optimize for max stroke (less impact) and max work done by damper